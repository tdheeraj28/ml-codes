!pip install keras-visualizer
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
import pandas as pd
from keras_visualizer import visualizer
from keras import models, layers
from tensorflow.keras.optimizers import Adam
from keras.callbacks import EarlyStopping
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
import numpy as np
import warnings
warnings.filterwarnings('ignore')
df = pd.read_csv('indians-diabetes.csv')
df.info()
df.describe()
X = df.iloc[:, :-1].values  
y = df.iloc[:, -1].values   

scaler = StandardScaler()
X = scaler.fit_transform(X)


X_train, X_val, y_train, y_val = train_test_split(
    X, y,
    test_size=0.2,
    random_state=42,
    stratify=y   
)


model = Sequential()
model.add(Dense(12, input_dim=X.shape[1], activation='relu'))
model.add(Dense(8, activation='relu'))
model.add(Dense(9, activation='relu'))
model.add(Dense(1, activation='sigmoid'))  


learning_rate = 0.001  
optimizer = Adam(learning_rate=learning_rate)


model.compile(loss='binary_crossentropy', optimizer=optimizer, metrics=['accuracy'])


early_stopping = EarlyStopping(monitor='val_loss', patience=3, restore_best_weights=True)


model.fit(
    X_train, y_train,
    validation_data=(X_val, y_val),
    epochs=100,
    batch_size=10,
    callbacks=[early_stopping]
)
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay
import matplotlib.pyplot as plt


for dataset, X_data, y_data in [("Training", X_train, y_train), ("Validation", X_val, y_val)]:
    loss, accuracy = model.evaluate(X_data, y_data, verbose=0)
    error = 1 - accuracy
    print(f"{dataset} Accuracy: {accuracy * 100:.2f}%")
    print(f"{dataset} Error: {error * 100:.2f}%\n")


y_pred = model.predict(X_val) 
y_pred_class = (y_pred > 0.5).astype("int32")  


print("\nPredicted Probabilities (first 10):")
print(y_pred[:10].flatten())

print("\nPredicted Classes (first 10):")
print(y_pred_class[:10].flatten())

print("\nActual Labels (first 10):")
print(y_val[:10])


cm = confusion_matrix(y_val, y_pred_class)


disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=["No Diabetes (0)", "Diabetes (1)"])
disp.plot(cmap='Blues', values_format='d')

plt.title("Confusion Matrix for Validation Set")
plt.show()


print("\nConfusion Matrix (numeric):")
print(cm)
def get_user_input():
    print("Please enter the following details:")
    pregnancies = float(input("Number of pregnancies: "))
    glucose = float(input("Glucose level: "))
    blood_pressure = float(input("Blood pressure: "))
    skin_thickness = float(input("Skin thickness: "))
    insulin = float(input("Insulin level: "))
    bmi = float(input("BMI: "))
    diabetes_pedigree = float(input("Diabetes Pedigree Function: "))
    age = float(input("Age: "))


    user_data = np.array([[pregnancies, glucose, blood_pressure, skin_thickness,
                           insulin, bmi, diabetes_pedigree, age]])
    user_data = scaler.transform(user_data)  
    return user_data

\
def predict_diabetes():
    user_data = get_user_input()
    prediction = model.predict(user_data)

    
    if prediction >= 0.5:
        print("The model predicts that you are diabetic.")
    else:
        print("The model predicts that you are not diabetic.")


predict_diabetes()
visualizer(model, file_format='png', view=True)

# conda install -c conda-forge graphviz python-graphviz
# pip install graphviz pydot keras-visualizer

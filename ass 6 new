import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from tensorflow.keras.models import Sequential
from tensorflow.keras.optimizers import Adam
from tensorflow.keras.layers import Dense
from keras import models, layers
from keras_visualizer import visualizer
from keras.callbacks import EarlyStopping
from sklearn.model_selection import train_test_split as tts
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay
from sklearn.preprocessing import StandardScaler
import warnings
warnings.filterwarnings('ignore')
df=pd.read_csv("pima-indians-diabetes.csv")
df.head()
df.describe()
X=df.iloc[:, :-1].values
y=df.iloc[:, -1].values

scaler=StandardScaler()
X=scaler.fit_transform(X)

X_train, X_val, y_train, y_val=tts(X, y, test_size=0.2, random_state=42)

model=Sequential()

model.add(Dense(4, input_dim=X.shape[1], activation='relu'))
model.add(Dense(2, activation='relu'))
model.add(Dense(5, activation='relu'))
model.add(Dense(1, activation='sigmoid'))

learning_rate=float(input("Enter the Learning Rate for example (0.001): "))

optimizer=Adam(learning_rate=learning_rate)

model.compile(loss="binary_crossentropy", optimizer=optimizer, metrics=["accuracy"])

early_stopping=EarlyStopping(monitor="val_loss", patience=5, restore_best_weights=True)

model.fit(X_train, y_train, validation_data=(X_val, y_val), epochs=100, batch_size=10, callbacks=[early_stopping])
visualizer(model, file_format='png', view=True)
for dataset, train_data, test_data in [("Training Data", X_train, y_train), ("Validation Data", X_val, y_val)]:
    loss, accuracy=model.evaluate(train_data, test_data, verbose=0)
    error=1-accuracy
    print(f"Accuracy: {accuracy*100:.2f}%")
    print(f"Error: {error*100:.2f}%")

y_pred=model.predict(X_val)
y_pred_class=(y_pred>0.5).astype("int32")

cm=confusion_matrix(y_val, y_pred_class)
display=ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=["Not Diabetic (0)", "Diabetic (1)"])
display.plot(cmap="Reds", values_format='d')

print(f"{cm}")
